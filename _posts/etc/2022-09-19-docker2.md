---
title:  "[docker] ë„ì»¤ğŸ‹ ì°¨ê·¼ì°¨ê·¼ ì•Œì•„ë³´ê¸° 2"
excerpt: ""

categories:
  - python
  - docker
  - etc
  
tags: [study, python, docker]

last_modified_at: 2022-09-19T08:06:00-05:00
---

ì´ë²ˆì—” ì•ì„œ í•˜ë˜ ë„ì»¤ ì´ë¯¸ì§€ ë§ê³  ë‹¤ë¥¸ ì‹ìœ¼ë¡œ ì‹œë„í•´ë³´ì•˜ë‹¤.
ì•ì„œ ì‹œë„í•œ ê²ƒì€, íŒŒì¼ê¹Œì§€ ìë™ìœ¼ë¡œ ëŒë¦´ ìˆ˜ ìˆëŠ” image ë¥¼ ë§Œë“¤ì–´ì„œ run ëª…ë ¹ì–´ í•˜ë‚˜ì— ëë‚´ëŠ” ê²ƒì´ì—ˆëŠ”ë°, ìƒê°ì„ ë°”ê¾¸ì–´ì„œ, í•„ìš”í•œ docker í™˜ê²½ì„ ì—´ë©´ ê·¸ ì•ˆì—ì„œ í•„ìš”í•œ íŒŒì¼ë“¤ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” í˜•ì‹ìœ¼ë¡œ í•˜ë„ë¡ í•˜ì˜€ë‹¤. 

í•„ìš”í•œ cuda imageë¥¼ pull í•´ì˜¤ê³ , ê·¸ pull í•´ì˜¨ image ì— ë‚´ê°€ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì¶”ê°€ë¡œ  install í•˜ì—¬ ë‚˜ë§Œì˜ custum docker image ë¥¼ ë§Œë“¤ì–´ì„œ, ë°°í¬ê°€ ê°€ëŠ¥í•˜ê²Œ docker hub ì— ì˜¬ë¦¬ëŠ” ê²ƒ ê¹Œì§€ í•˜ì˜€ë‹¤. 

í˜¹ì‹œ ë„ì»¤ ì„¤ì¹˜ë¶€í„° í•˜ê³ ì‹¶ì€ ì‚¬ëŒì€ [[docker] ë„ì»¤ğŸ‹ ì°¨ê·¼ì°¨ê·¼ ì•Œì•„ë³´ê¸°](https://chaelin0722.github.io/python/docker/etc/docker_basic/) ì—¬ê¸° ì°¸ê³ !

## docker login

~~~
docker login
~~~
ë¡œê·¸ì¸ í•˜ìë§ˆì sock permission denied... 

![image](https://user-images.githubusercontent.com/53431568/191421868-c8d27b0d-606f-46de-a954-c89e4bf8d633.png)

group ì— ê¶Œí•œ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤. chomod 666ìœ¼ë¡œ read write ë“± ë‹¤ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ì

~~~
sudo chmod 666 /var/run/docker.sock
~~~

ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë‹ˆ ì„±ê³µí•˜ì˜€ë‹¤ í˜¸í˜¸

![image](https://user-images.githubusercontent.com/53431568/191421793-21ff0348-8fa8-4dea-b15d-4056f5835b98.png)

 
 ## docker run
 
 gpu ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ --gpus íƒœê·¸ë¥¼ ì¶”ê°€í•˜ê³ , all ì€ gpuê°€ ëª‡ê°œë˜ ë‹¤ ì½ì–´ì˜¤ê² ë‹¤ëŠ” ëœ»ì´ë‹¤ ë§Œì•½ 4ê°œì¤‘ 0ë²ˆê³¼ 1ë²ˆì§¸ê²ƒë§Œ ê°€ì ¸ì˜¤ê³  ì‹¶ë‹¤ë©´ --gpus '"devices=0,1"' ìœ¼ë¡œ ì„¤ì •í•´ì£¼ë©´ëœë‹¤. 
 -v ë‹¤ìŒì— $(pwd)ëŠ” í˜„ì¬ ì‘ì—…ìœ„ì¹˜ë¥¼ ëœ»í•˜ê³  ê·¸ ë’¤ì— ë‚´ê°€ ì ‘ê·¼í•˜ê³  ì‹¶ì€ ê²½ë¡œë¥¼ ì ì–´ì¤€ë‹¤. ë‚˜ëŠ” ì ˆëŒ€ê²½ë¡œë¡œ ë„£ì–´ì£¼ì—ˆë‹¤. ê·¸ë¦¬ê³  --rm ë’¤ì—ëŠ” ì‚¬ìš©í•  ë„ì»¤ì´ë¯¸ì§€ í’€ë„¤ì„ì„ ì“°ê³  ì‹¤í–‰..!
 
~~~
docker run --gpus all -it -v $(pwd):/home/clkim/GONGIN --rm  nvidia/cuda:10.0-cudnn7-devel-ubuntu18.04
~~~

![image](https://user-images.githubusercontent.com/53431568/191019507-3298cf2f-f825-4057-9cd7-063f0a46a3ab.png)


## run ì´í›„ ì¶”ê°€ë¡œ ì„¤ì¹˜í•´ ì¤€ ê²ƒ!

~~~
apt-get update -y
apt-get -y install libgl1-mesa-glx
apt-get install -y python3-pip python-dev build-essential
pip3 install --upgrade pip
apt-get install vim
pip install tensorflow-gpu==2.0.0
~~~

ë§Œì•½ ì²«ì¤„ë¶€í„° ë‹¤ìŒê³¼ ê°™ì€ GPG KEY ì—ëŸ¬ê°€ ë‚œë‹¤ë©´..

![image](https://user-images.githubusercontent.com/53431568/191249567-24c2b5ee-7c09-4b89-9bcc-aaea57bc83e0.png)

ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰í•˜ë©´ ëœë‹¨ë‹¤!
~~~
apt-key del 7fa2af80 && apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/3bf863cc.pub
~~~

í•˜ì§€ë§Œ ë‚œ ì•ˆë˜ë¯€ë¡œ.. ì•„ë˜ ì‚¬ì´íŠ¸ë“¤ì„ ì°¸ê³ í•˜ì—¬ì„œ pub key ì§€ìš°ê³  ë³¸ì¸ì´ í•´ë‹¹í•˜ëŠ” cuda ë²„ì „ì˜ keyë¥¼ ë°›ì•„ì„œ ì¨ì£¼ì
[https://developer.nvidia.com/blog/updating-the-cuda-linux-gpg-repository-key/](https://developer.nvidia.com/blog/updating-the-cuda-linux-gpg-repository-key/)

[https://forums.developer.nvidia.com/t/updating-the-cuda-linux-gpg-repository-key/212897/7](https://forums.developer.nvidia.com/t/updating-the-cuda-linux-gpg-repository-key/212897/7)


ì˜ˆì‹œ))
~~~
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/cuda-keyring_1.0-1_all.deb
~~~

ë˜í•œ, TIME OUT ì—ëŸ¬ì‹œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ë³´ì

~~~
sudo pip install --default-timeout=100 future
~~~

ì—ëŸ¬ë“¤ì„ í•´ê²°í–ˆë‹¤ë©´ ë‹¤ìŒ basrh ì— cuda ì •ë³´ë¥¼ ì¶”ê°€í•˜ì!

~~~
vim ~/.bashrc
~~~

í•˜ë©´ bashrc ì½”ë“œê°€ ë‚˜ì˜¤ëŠ”ë°, ì—¬ê¸°ì—ë‹¤ê°€ ë³¸ì¸ì˜ cuda ë²„ì „ì— ë§ê²Œë” ìˆ˜ì •í•˜ì—¬ì„œ ë§¨ ì•„ë˜ì—ë‹¤ê°€ ì•„ë˜ ë‚´ìš©ì„ ì‚½ì…í•´ì£¼ì! ë‚˜ëŠ” cuda 10.0 ì´ë¼ì„œ 10.0
~~~
# <<< conda initialize <<<
export PATH=$PATH:/usr/local/cuda-10.0/bin
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda-10.0/lib64
export CUDADIR=/usr/local/cuda-10.0
export CUDA_NVRTC_LIB=/usr/local/cuda-10.0/include/nvrtc.h
export CUDA_HOME=/usr/local/cuda-10.0/
~~~

~~~
source ~/.bashrc
~~~

ì´ëŸ°ì‹ìœ¼ë¡œ ë³¸ì¸ì´ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ì„ ì„¤ì¹˜í•˜ì—¬ í™˜ê²½ì„ êµ¬ì„±í•˜ì˜€ê³ , íŒŒì¼ì´ ì˜ ëŒì•„ê°„ë‹¤ë©´ ì™„ì„±! ì´ë‹¤. 

## image push

ì´ì œ ìµœì¢…ì ìœ¼ë¡œ ë‚´ê°€ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ë‹¤ ì„¤ì¹˜ëœ ì»¨í…Œì´ë„ˆë¥¼ image ë¡œ ë§Œë“¤ì–´ push í•˜ë©´ëœë‹¤.

ë¨¼ì €, í˜„ container ìƒíƒœë¡œ image ë¡œ ë§Œë“¤ê¸° ìœ„í•´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì¤€ë‹¤.

docker commit -m [image ì„¤ëª…] -a [ ì‚¬ìš©ì mail ] [ container Name or ID ] [ ìƒì„±í•  image name : Tag ]

~~~
docker commit -m "tensorflow 2.0 image with cuda10.0" -a "example@naver.com" bbEXAMPLE75fb5 example:v0.1
~~~

ì•”í˜¸ë¬¸ìê°™ì€ê²ƒì´ ìƒì„±ë˜ì—ˆë‹¤ 
![image](https://user-images.githubusercontent.com/53431568/191423314-2295bab3-ca09-402c-8179-f8498eb3b491.png)

ì´ë¯¸ì§€ ìƒì„±í™•ì¸! ì„±ê³µí•˜ì˜€ë‹¤.
![image](https://user-images.githubusercontent.com/53431568/191423148-2ac2d25a-7972-4af5-a1dc-24906854c887.png)

ì´ì œ image tag ì‘ì—…ì„ í•´ì£¼ì! ë‚´ ì•„ì´ë””ë¥¼ ì•ì— ì¨ì£¼ë©´ ëœë‹¤.

docker tag [ image name or Tag ] [ docker hub ID í˜¹ì€ private registry ip:port ] 

~~~
docker tag noah:v1.0 zzennin/noah:v1.0
~~~

ì´ì œ `push` í•´ì£¼ì (push ëŠ” docker login í•œ ìƒíƒœì—ì„œ í•˜ëŠ”ê±° ìŠì§€ ë§ì)

~~~
docker push noah:v1.0
~~~

ì´ì œ ë!

/
.
.
.
í•˜ë©´ ì¢‹ì„í…ë° ë‚˜ëŠ” ë˜ ì—ëŸ¬.. ì—ëŸ¬ë‚œ ì‚¬ëŒ ì—¬ê¸° ëª¨ì—¬~ 

![image](https://user-images.githubusercontent.com/53431568/191430110-93fb5027-9a0e-4270-9aaa-1fc4cbe1f5e5.png)

ì•„ë˜ ì‚¬ì´íŠ¸ëŒ€ë¡œ nameserver ì¶”ê°€í•´ì¤€ í›„ restart í•´ì£¼ë‹ˆ ë˜ì—ˆë‹¤! êµ¿!

[https://stackoverflow.com/questions/47580528/error-response-from-daemon-get-https-registry-1-docker-io-v2-dial-tcp-look](https://stackoverflow.com/questions/47580528/error-response-from-daemon-get-https-registry-1-docker-io-v2-dial-tcp-look)



## ì•Œì•„ë‘ë©´ í¸ë¦¬í•œ ë„ì»¤ ëª…ë ¹ì–´ë“¤!

### ë„ì»¤ ì»¨í…Œì´ë„ˆ ë¹ ì ¸ë‚˜ì˜¤ê¸°

ê·¸ëƒ¥ `exit` ì¹˜ê³  ì—”í„°~

### ê°™ì€ imageì˜ ë„ì»¤ ì»¨í…Œì´ë„ˆ ë” ë§Œë“¤ê¸°

ì»¨í…Œì´ë„ˆ ë” ì—´ê³ ì‹¶ìœ¼ë©´! container id ë¥¼ ì•Œê³  ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ ë¨

docker exec -it [container id í˜¹ì€ ì´ë¦„] /bin/bash

~~~
docker exec -it 2fee1f881c52 /bin/bash
~~~


